<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Leihehe"><meta name="copyright" content="Leihehe"><meta name="generator" content="Hexo 6.0.0"><meta name="theme" content="hexo-theme-yun"><title>Amazing URL Shortener - Technical Doc | LeiH - Blog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-okaidia.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="icon" type="image/png" href="/logo.png"><link rel="mask-icon" href="/logo.png" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="preload" href="/js/prism.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"leihehe.top","root":"/","title":["LeiH's","Blog"],"version":"1.7.0","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><script src="/js/prism.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap"><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-M9KWR9L');</script><!-- End Google Tag Manager --><meta name="description" content="IntroductionAmazing URL Shortener is an online tool with high availability to shorten a long link and provide detailed statistics. Demo:  http:&#x2F;&#x2F;official.urls.fit http:&#x2F;&#x2F;short.urls.fit  username: test">
<meta property="og:type" content="article">
<meta property="og:title" content="Amazing URL Shortener - Technical Doc">
<meta property="og:url" content="https://leihehe.top/2022/12/04/Amazing-URL-Shortener-Technical-Doc/index.html">
<meta property="og:site_name" content="LeiH - Blog">
<meta property="og:description" content="IntroductionAmazing URL Shortener is an online tool with high availability to shorten a long link and provide detailed statistics. Demo:  http:&#x2F;&#x2F;official.urls.fit http:&#x2F;&#x2F;short.urls.fit  username: test">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog-1300132498.cos.ap-nanjing.myqcloud.com/blog/202212042225127.png">
<meta property="og:image" content="https://blog-1300132498.cos.ap-nanjing.myqcloud.com/blog/20230406225347.png">
<meta property="og:image" content="https://blog-1300132498.cos.ap-nanjing.myqcloud.com/blog/20221129155609.png">
<meta property="og:image" content="https://blog-1300132498.cos.ap-nanjing.myqcloud.com/blog/20221129155800.png">
<meta property="og:image" content="https://blog-1300132498.cos.ap-nanjing.myqcloud.com/blog/20221129155832.png">
<meta property="og:image" content="https://blog-1300132498.cos.ap-nanjing.myqcloud.com/blog/20221129155900.png">
<meta property="og:image" content="https://blog-1300132498.cos.ap-nanjing.myqcloud.com/blog/image-20221129155931898.png">
<meta property="article:published_time" content="2022-12-04T11:42:28.000Z">
<meta property="article:modified_time" content="2023-04-07T04:14:38.670Z">
<meta property="article:author" content="Leihehe">
<meta property="article:tag" content="Java Project">
<meta property="article:tag" content="URL shortener">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog-1300132498.cos.ap-nanjing.myqcloud.com/blog/202212042225127.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info mickey-mouse"><a class="site-author-avatar" href="/about/" title="Leihehe"><img width="96" loading="lazy" src="/image/avatar.png" alt="Leihehe"><span class="site-author-status" title="学习学习再学习努力努力再努力">😊</span></a><div class="site-author-name"><a href="/about/">Leihehe</a></div><span class="site-name">LeiH - Blog</span><sub class="site-subtitle"></sub><div class="site-desciption">我该说些什么呢？</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="My Home"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/about/"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-user-line"></use></svg></span></a></div><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">49</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">21</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">30</span></a></div><a class="site-state-item hty-icon-button" href="/about/#comment" title="留言板"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-clipboard-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/leihehehe" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:hslscarlett@gmail.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="友情链接" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Technical-Stacks-Used"><span class="toc-number">2.</span> <span class="toc-text">Technical Stacks Used</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ShardingSphere"><span class="toc-number">2.1.</span> <span class="toc-text">ShardingSphere</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Why-use-it"><span class="toc-number">2.1.1.</span> <span class="toc-text">Why use it?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Partition-Keys"><span class="toc-number">2.1.2.</span> <span class="toc-text">Partition Keys</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#How-to-query-the-data-in-this-case"><span class="toc-number">2.1.3.</span> <span class="toc-text">How to query the data in this case?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redis-Redisson-amp-Lua-Script"><span class="toc-number">2.2.</span> <span class="toc-text">Redis, Redisson &amp; Lua Script</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RabbitMQ"><span class="toc-number">2.3.</span> <span class="toc-text">RabbitMQ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Flink-Kafka-amp-ClickHouse"><span class="toc-number">2.4.</span> <span class="toc-text">Flink, Kafka &amp; ClickHouse</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Jenkins-amp-Kubernetes-High-Availability"><span class="toc-number">2.5.</span> <span class="toc-text">Jenkins &amp; Kubernetes(High Availability)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Technical-Difficulties-amp-Solutions"><span class="toc-number">3.</span> <span class="toc-text">Technical Difficulties &amp; Solutions</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#User-and-Visitors-Querying-Links"><span class="toc-number">3.1.</span> <span class="toc-text">User and Visitors Querying Links</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Distributed-Transaction-Management"><span class="toc-number">3.2.</span> <span class="toc-text">Distributed Transaction Management</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Two-Users-Creating-the-Same-Short-Link"><span class="toc-number">3.3.</span> <span class="toc-text">Two Users Creating the Same Short Link</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx-Short-Link-Access-and-API-server"><span class="toc-number">3.4.</span> <span class="toc-text">Nginx - Short Link Access and API server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Eureka-Servers"><span class="toc-number">3.5.</span> <span class="toc-text">Eureka Servers</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Database-Structure-ER-Diagram"><span class="toc-number">4.</span> <span class="toc-text">Database Structure (ER Diagram)</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://leihehe.top/2022/12/04/Amazing-URL-Shortener-Technical-Doc/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Leihehe"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="LeiH - Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Amazing URL Shortener - Technical Doc</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="Created: 2022-12-04 22:42:28" itemprop="dateCreated datePublished" datetime="2022-12-04T22:42:28+11:00">2022-12-04</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="Modified: 2023-04-07 14:14:38" itemprop="dateModified" datetime="2023-04-07T14:14:38+10:00">2023-04-07</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="Word count in article"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-file-word-line"></use></svg></span> <span title="Word count in article">1k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="Reading time"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-timer-line"></use></svg></span> <span title="Reading time">6m</span></span></span><div class="post-classify"><span class="post-tag"><a class="tag-item" href="/tags/Java-Project/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Java Project</span></a><a class="tag-item" href="/tags/URL-shortener/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">URL shortener</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Amazing URL Shortener is an online tool with high availability to shorten a long link and provide detailed statistics.</p>
<p><strong>Demo</strong>:</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://official.urls.fit/">http://official.urls.fit</a></li>
<li><a target="_blank" rel="noopener" href="http://short.urls.fit/">http://short.urls.fit</a></li>
</ul>
<p><code>username: test</code></p>
<p><code>password: test</code></p>
<p><strong>Short link demo</strong>: <code>urls.fit/a26B4EM0</code></p>
<p><strong>GitHub repo:</strong> </p>
<ul>
<li>Backend: <a target="_blank" rel="noopener" href="https://github.com/leihehehe/java-url-shortener">https://github.com/leihehehe/java-url-shortener</a></li>
<li>Frontend: currently is a private repo</li>
</ul>
<span id="more"></span>

<h1 id="Technical-Stacks-Used"><a href="#Technical-Stacks-Used" class="headerlink" title="Technical Stacks Used"></a>Technical Stacks Used</h1><p><strong>Backend Techniques:</strong> </p>
<ul>
<li><p><strong>Framework</strong>: SpringBoot, Spring Cloud</p>
</li>
<li><p><strong>Gateway</strong>: Spring Cloud Gateway</p>
</li>
<li><p><strong>Message Queues</strong>: RabbitMQ, Kafka</p>
</li>
<li><p><strong>Database-related Techs</strong>: Redis, Redisson(operating on Redis), ClickHouse, SpringData JPA, MySQL,  Apache Shardingsphere</p>
</li>
<li><p><strong>Data Streaming-processing Framework</strong>: Flink</p>
</li>
<li><p><strong>Availability</strong>: resillience4j</p>
</li>
<li><p><strong>Others</strong>: Openfeign, etc.</p>
</li>
</ul>
<p><strong>Frontend:</strong> Angular.js</p>
<p><strong>DevOps</strong>:</p>
<ul>
<li>Jenkins</li>
<li>Kubernetes</li>
</ul>
<h2 id="ShardingSphere"><a href="#ShardingSphere" class="headerlink" title="ShardingSphere"></a>ShardingSphere</h2><blockquote>
<p><strong>ShardingSphere</strong> provides a distributed database solution based on the underlying database, which can scale computing and storage horizontally</p>
</blockquote>
<h3 id="Why-use-it"><a href="#Why-use-it" class="headerlink" title="Why use it?"></a>Why use it?</h3><p>Since we are developing a system that can handle massive data, it is not possible to just use one single database or a few tables to store the data. Storing massive data in only one node or database will cause much pressure on the database itself, and speed will be significantly slowed down.</p>
<p>Therefore, it is necessary to do sharding and partitioning. For example, I divided the <code>product_order</code> table into two tables stored in the <code>url_shop</code> database and divided the <code>short_link</code> table into 6 tables and every two tables are distributed in a <code>url_link</code> table. (For more details, please see the <strong>Database Structure</strong> part)</p>
<h3 id="Partition-Keys"><a href="#Partition-Keys" class="headerlink" title="Partition Keys"></a>Partition Keys</h3><p>Partition keys are set in terms of different cases. For example, for users to find their orders quickly, <code>accountNo</code> is used as a partition key, so that a user’s orders will be in the same table.</p>
<p>Another situation is that we need to handle a large number of shortened links across multiple databases and tables. In this case, I use <code>accountNo</code> as a partition key to finding out which <strong>databases</strong> the records are currently in. Besides, <code>groupId</code> is used as a partition key for finding out which <strong>tables</strong> the records are currently in.</p>
<h3 id="How-to-query-the-data-in-this-case"><a href="#How-to-query-the-data-in-this-case" class="headerlink" title="How to query the data in this case?"></a>How to query the data in this case?</h3><p>I used two methods to query the data</p>
<ul>
<li><strong>Modulo</strong>. For example, <code>k = accountNo mod n</code> where n is the number of tables that will query the <strong>kth</strong> table </li>
<li><strong>Store database and column info in the data itself</strong>. For example, we got a short link code stored in the database <code>a</code> and table <code>2</code>, then we can update the short link code to <code>axxxx2</code>, so that we could quickly locate this short link when querying the data.</li>
</ul>
<h2 id="Redis-Redisson-amp-Lua-Script"><a href="#Redis-Redisson-amp-Lua-Script" class="headerlink" title="Redis, Redisson &amp; Lua Script"></a>Redis, Redisson &amp; Lua Script</h2><ul>
<li>Redis is used as a cache in the project. It stores the users’ plan data information to prevent frequent requests to the MySQL database.</li>
<li>Redis and Redisson are used together to handle distributed locks. In addition to using Redisson, Lua script is also straightforward and used for creating locks.</li>
</ul>
<h2 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h2><ul>
<li>RabbitMQ is used to slow down the response waiting time as operations can be asynchronously executed by sending messages.</li>
<li>RabbitMQ is also used to deliver delayed messages for different purposes like order cancellation and distributed transactions.</li>
<li>Compared to <code>Kafka</code>, it is more suitable for an e-commerce business service(e.g. scheduled tasks and distributed transaction management) </li>
</ul>
<h2 id="Flink-Kafka-amp-ClickHouse"><a href="#Flink-Kafka-amp-ClickHouse" class="headerlink" title="Flink, Kafka &amp; ClickHouse"></a>Flink, Kafka &amp; ClickHouse</h2><blockquote>
<p><strong>Flink is used for processing data streams at a large scale and to deliver real-time analytical insights about your processed data with your streaming application</strong>.</p>
</blockquote>
<p>In this project, I used <code>Flink</code> to get visitor information when a visitor is trying to access a shortened link. Flink helps to process the visitor information in each layer and pass the processed information to the next layer using <code>Kafka</code>.</p>
<p>At the last layer, I used Flink to pass the final datasets to ClickHouse which is a fast column-oriented database management system.</p>
<p>ClickHouse allows us to generate analytical reports using SQL queries.</p>
<h2 id="Jenkins-amp-Kubernetes-High-Availability"><a href="#Jenkins-amp-Kubernetes-High-Availability" class="headerlink" title="Jenkins &amp; Kubernetes(High Availability)"></a>Jenkins &amp; Kubernetes(High Availability)</h2><p>The Jenkins file is included in the project, and both front-end and back-end projects are deployed using Kubernetes and Jenkins.</p>
<p>Jenkins runs a piepeline to build and upload images to AWS ECR.</p>
<p>Using <strong>3</strong> servers(<strong>1 master node and 1 worker node</strong>) to build a Kubernetes cluster. </p>
<p><img src="https://blog-1300132498.cos.ap-nanjing.myqcloud.com/blog/202212042225127.png" alt="kubernetes deployments" loading="lazy"></p>
<h1 id="Technical-Difficulties-amp-Solutions"><a href="#Technical-Difficulties-amp-Solutions" class="headerlink" title="Technical Difficulties &amp; Solutions"></a>Technical Difficulties &amp; Solutions</h1><h2 id="User-and-Visitors-Querying-Links"><a href="#User-and-Visitors-Querying-Links" class="headerlink" title="User and Visitors Querying Links"></a>User and Visitors Querying Links</h2><p>As we know users prefer to query links in terms of their <code>accountNo</code>, if the links are distributed in different databases and tables, it will be very difficult for users to query the data since the system needs to access all the databases and tables to get the records.</p>
<p>However, visitors, just need the <strong>short link code</strong> to locate the table, and they have no idea about the <code>groupId</code> and <code>accountNo</code>.</p>
<p>So apparently, we would have two different partition keys to deal with these two cases.</p>
<p>Therefore, I duplicated the tables so that tables <code>group_link_mapping</code> are used to store data for users, <code>short_link</code> tables are used to store data for visitors.</p>
<h2 id="Distributed-Transaction-Management"><a href="#Distributed-Transaction-Management" class="headerlink" title="Distributed Transaction Management"></a>Distributed Transaction Management</h2><p>New issues have arisen after duplicating the short link tables. Since tables need to be synchronized, there will be inconsistent data if the operation on the user side failed but succeed on the visitor side.</p>
<p><strong>Solution</strong>: Use <code>RabbitMQ</code> to send a <strong>delayed message</strong> to check if operations on both sides are successful.</p>
<h2 id="Two-Users-Creating-the-Same-Short-Link"><a href="#Two-Users-Creating-the-Same-Short-Link" class="headerlink" title="Two Users Creating the Same Short Link"></a>Two Users Creating the Same Short Link</h2><p>If two users are generating the same short link, <strong>user A</strong> has inserted data to <code>group_link_mapping</code> and <strong>user B</strong> has inserted data into <code>short_link</code>, at this time, both users will fail because they cannot insert data into others tables(data already exists).</p>
<p><strong>Solution</strong>: Use <code>Redis</code> to add a lock. The value stored in the Redis will be <code>accountNo</code>, if <code>accountNo</code> in the Redis matches the current logged-in <code>accountNo</code>, continue the operations. Otherwise, stop the operations(another user is holding the lock).</p>
<h2 id="Nginx-Short-Link-Access-and-API-server"><a href="#Nginx-Short-Link-Access-and-API-server" class="headerlink" title="Nginx - Short Link Access and API server"></a>Nginx - Short Link Access and API server</h2><p><strong>Updates</strong>: </p>
<p>I have changed the Load balancer to Nginx. Using Nginx can help us load balance and proxy traffic to bankend servers. It significantly saves the overhead of using the AWS load balancer.</p>
<hr>
<p><del>I used the <strong>Load Balancer</strong> in AWS to forward different requests with different URLs and the specific port (80). Basically, we will have two different domains for websites and shorten urls.</del></p>
<p><img src="https://blog-1300132498.cos.ap-nanjing.myqcloud.com/blog/20230406225347.png" loading="lazy"></p>
<h2 id="Eureka-Servers"><a href="#Eureka-Servers" class="headerlink" title="Eureka Servers"></a>Eureka Servers</h2><p>I did not deploy Eureka servers to Kubernetes. Instead, I deployed them to another machine and used Docker network functions to enable communication between them.</p>
<h1 id="Database-Structure-ER-Diagram"><a href="#Database-Structure-ER-Diagram" class="headerlink" title="Database Structure (ER Diagram)"></a>Database Structure (ER Diagram)</h1><p><strong>url_shop</strong></p>
<p><img src="https://blog-1300132498.cos.ap-nanjing.myqcloud.com/blog/20221129155609.png" loading="lazy"></p>
<p><strong>url_link_0</strong></p>
<p><img src="https://blog-1300132498.cos.ap-nanjing.myqcloud.com/blog/20221129155800.png" loading="lazy"></p>
<p><strong>url_link_1</strong></p>
<p><img src="https://blog-1300132498.cos.ap-nanjing.myqcloud.com/blog/20221129155832.png" loading="lazy"></p>
<p><strong>url_link_a</strong></p>
<p><img src="https://blog-1300132498.cos.ap-nanjing.myqcloud.com/blog/20221129155900.png" loading="lazy"></p>
<p><strong>url_shop</strong></p>
<p><img src="https://blog-1300132498.cos.ap-nanjing.myqcloud.com/blog/image-20221129155931898.png" loading="lazy"></p>
</div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>Leihehe</li><li class="post-copyright-link"><strong>Post link: </strong><a href="https://leihehe.top/2022/12/04/Amazing-URL-Shortener-Technical-Doc/" title="Amazing URL Shortener - Technical Doc">https://leihehe.top/2022/12/04/Amazing-URL-Shortener-Technical-Doc/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless otherwise stated.</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2023/03/14/Bitmaps-in-Algorithms/" rel="prev" title="Bitmaps in Algorithms"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">Bitmaps in Algorithms</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2022/11/16/FIT3031-Network-Security-Notes/" rel="next" title="FIT3031 Network Security Notes"><span class="post-nav-text">FIT3031 Network Security Notes</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>说点什么好呢？</span><br></div><style>.utterances {
  max-width: 100%;
}</style><script src="https://utteranc.es/client.js" repo="leihehehe/leihehehe.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2021 – 2023 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> Leihehe</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="Search"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="Searching..." value=""></div><div id="local-search-result"></div></div></div></body></html>